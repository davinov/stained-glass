(function(){var t;t=function(){function t(t){var i;this.img=t,i=this.img,this.width=i.width,this.height=i.height,this.mapImageColors(),this.generateDistribution()}return t.prototype.polygon=function(t){return"M"+t.join("L")+"Z"},t.prototype.generateDistribution=function(){return this.vertices=d3.range(100).map(function(t){return function(){return[Math.random()*t.width,Math.random()*t.height]}}(this)),this.voronoi=d3.geom.voronoi().clipExtent([[0,0],[this.width,this.height]]),this.svg=d3.select("body").append("svg").attr("width",this.width).attr("height",this.height).style({position:"absolute",top:0,left:0}),this.pathGroup=this.svg.append("g"),this.updateDistribution()},t.prototype.updateDistribution=function(){var t;return t=this.pathGroup.selectAll("path").data(this.voronoi(this.vertices),this.polygon),t.exit().remove(),t.enter().append("path").attr("d",this.polygon),t.order(),this.updateColors()},t.prototype.updateColors=function(){return this.pathGroup.selectAll("path").attr("fill",function(t){return function(i){var e;return e=t.getImageColors(Math.round(i.point[0]),Math.round(i.point[1])),console.log(e),"rgb("+e[0]+","+e[1]+","+e[2]+")"}}(this))},t.prototype.mapImageColors=function(){return this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.getContext("2d").drawImage(this.img,0,0,this.width,this.height)},t.prototype.getImageColors=function(t,i){return t=d3.max([0,t]),i=d3.max([0,i]),t=d3.min([t,this.width-1]),i=d3.min([i,this.height-1]),this.canvas.getContext("2d").getImageData(t,i,1,1).data},t}(),window.StainedGlass=t}).call(this);